<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ajax与跨域 | Libra</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/vuepress_theme_libra/favicon.ico">
    <meta name="description" content="a vuepress theme by libra">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/vuepress_theme_libra/assets/css/0.styles.c313087e.css" as="style"><link rel="preload" href="/vuepress_theme_libra/assets/js/app.81b11391.js" as="script"><link rel="preload" href="/vuepress_theme_libra/assets/js/4.45950cb6.js" as="script"><link rel="preload" href="/vuepress_theme_libra/assets/js/30.102e1636.js" as="script"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/1.2e06a9cb.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/10.60852d63.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/11.ee2a0c5d.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/12.190660e2.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/13.cb7fb853.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/14.416de39c.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/15.bf9ec89a.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/16.9a8b47a8.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/17.9168572d.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/18.461c471f.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/19.d2698337.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/20.f18da4ad.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/21.85704b86.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/22.f43db1ee.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/23.e31ab2b3.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/24.42421b44.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/25.1d55f477.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/26.48cbc0fe.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/27.9847d060.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/28.5e421513.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/29.dfb7b633.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/31.2377072d.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/32.63dede4d.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/33.88c8d1bd.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/34.a7ab9026.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/35.07369c57.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/36.7b44d369.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/37.05d4c89f.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/38.dd7a2184.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/39.13a5cfc2.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/40.2bdd360a.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/41.5e7eb681.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/42.72153d56.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/43.638dd185.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/44.a4552f11.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/45.d37a8e32.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/46.5d170fcc.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/47.d3fc8f48.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/48.d4daa220.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/49.180a1c96.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/5.76e49f54.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/50.5a96e7ed.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/51.c5d15611.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/52.c465ffcb.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/53.b7aca8de.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/54.1fe87c94.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/55.8e787bf0.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/56.21c25c0d.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/6.4bcad778.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/7.625d576e.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/8.2b069256.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/9.dc3026f2.js"><link rel="prefetch" href="/vuepress_theme_libra/assets/js/vuejs-paginate.710197ce.js">
    <link rel="stylesheet" href="/vuepress_theme_libra/assets/css/0.styles.c313087e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="article"><nav class="topbar"><span class="logo"><span class="logo-text">L</span></span> <ul class="menu"><li class="menu-item"><a href="/vuepress_theme_libra/" class="link router-link-active">主页</a></li> <li class="menu-item"><a href="/vuepress_theme_libra/blog" class="link">博客</a></li> <li class="menu-item"><a href="/vuepress_theme_libra/photography" class="link">摄影</a></li> <li class="menu-item"><a href="/vuepress_theme_libra/tag" class="link">标签</a></li> <li class="menu-item"><a href="/vuepress_theme_libra/category" class="link">分类</a></li> <li class="menu-item"><a href="/vuepress_theme_libra/timeline" class="link">时间线</a></li> <li class="menu-item"><a href="/vuepress_theme_libra/contact" class="link">联系我</a></li></ul> <div class="search"><i class="iconfont iconsearch"></i> <div class="search-box" data-v-89631566><input aria-label="Search" placeholder="请输入你想要搜索的内容..." autocomplete="off" spellcheck="false" value="" data-v-89631566> <!----></div></div> <span class="mobile-nav"><i class="iconfont iconnav"></i></span> <nav class="mobile-nav-item" style="display:none;"><div class="header-button"><i class="iconfont iconback"></i></div> <div class="header-info"><div class="avatar"><img src="https://libra321.oss-cn-huhehaote.aliyuncs.com/img/IMG_0386.JPG" alt="" class="avatar-img"></div> <span class="name">Libra</span> <i class="mail">libra085925@gmail.com</i> <div class="statistics"><span class="articles">
            39
            <i class="white"> 文章</i></span> <span class="verticle-line white">|</span> <span class="link">
            6
            <i class="white"> 分类</i></span></div></div> <div class="line"></div> <ul class="nav-menu"><li class="nav-menu-item"><a href="/vuepress_theme_libra/" class="router-link-active"><i class="iconfont iconhome"></i> <i class="white">主页</i></a></li> <li class="nav-menu-item"><a href="/vuepress_theme_libra/blog"><i class="iconfont iconblog"></i> <i class="white">博客</i></a></li> <li class="nav-menu-item"><a href="/vuepress_theme_libra/photography"><i class="iconfont iconblog"></i> <i class="white">摄影</i></a></li> <li class="nav-menu-item"><a href="/vuepress_theme_libra/tag"><i class="iconfont iconlabel"></i> <i class="white">标签</i></a></li> <li class="nav-menu-item"><a href="/vuepress_theme_libra/category"><i class="iconfont iconfenlei-"></i> <i class="white">分类</i></a></li> <li class="nav-menu-item"><a href="/vuepress_theme_libra/timeline"><i class="iconfont icontimeline"></i> <i class="white">时间线</i></a></li> <li class="nav-menu-item"><a href="/vuepress_theme_libra/contact"><i class="iconfont iconother"></i> <i class="white">联系我</i></a></li></ul></nav></nav> <div class="bg"></div> <div class="article-content"><div class="left"><span class="title animated rollIn">Ajax与跨域</span> <ul class="label animated zoomInUp"><li class="date"><i class="iconfont iconshizhong"></i>
          2023-02-15
        </li> <li class="update"><i class="iconfont iconUpdate"></i>
          2023-02-15
        </li> <li class="labels"><i class="iconfont iconlabel"></i>
          javascript
        </li></ul> <div class="image"><img src="https://libra321.oss-cn-huhehaote.aliyuncs.com/img/ajaxandcors.png" alt width="100%"></div> <div class="detail"><div><div class="content__default"><h2 id="ajax"><a href="#ajax" class="header-anchor">#</a> <code>Ajax</code></h2> <p><code>Ajax</code>（<code>Asynchronous JavaScript and XML</code>）是一种用于创建交互式<code>Web</code>应用程序的技术。它允许<code>Web</code>应用程序通过异步方式与<code>Web</code>服务器通信，无需刷新整个页面即可更新部分内容，从而提高了用户体验和<code>Web</code>应用程序的性能。</p> <p><code>Ajax</code>通过<code>JavaScript</code>、<code>XMLHttpRequest</code>和<code>DOM</code>技术实现。<code>JavaScript</code>负责收集用户输入和动态修改页面，<code>XMLHttpRequest</code>对象用于与<code>Web</code>服务器进行异步通信，<code>DOM</code>则用于将服务器响应更新到<code>Web</code>页面上。</p> <p>使用<code>Ajax</code>，<code>Web</code>应用程序可以通过以下步骤与<code>Web</code>服务器进行异步通信：</p> <ol><li>创建<code>XMLHttpRequest</code>对象</li> <li>使用<code>XMLHttpRequest</code>对象向<code>Web</code>服务器发送请求</li> <li>接收<code>Web</code>服务器的响应</li> <li>使用<code>DOM</code>将响应更新到<code>Web</code>页面上</li></ol> <h3 id="代码示例"><a href="#代码示例" class="header-anchor">#</a> 代码示例</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> method<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用该函数，可以轻松地发送<code>Ajax</code>请求并处理响应。例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">&quot;http://example.com/api/users&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">&quot;john@example.com&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;User created:&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to create user:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该函数返回一个<code>Promise</code>对象，该对象在请求成功时会调用<code>resolve</code>方法，并将服务器响应的字符串作为参数传递。在请求失败时，该对象会调用<code>reject</code>方法，并将错误消息字符串作为参数传递。在请求成功或失败后，可以使用<code>then</code>方法或<code>catch</code>方法分别处理响应或错误。</p> <h3 id="readystate"><a href="#readystate" class="header-anchor">#</a> <code>readyState</code></h3> <p><code>readyState</code>属性表示<code>XMLHttpRequest</code>对象的状态，它有 5 个可能的取值：</p> <ul><li>0: 代表请求尚未初始化，即<code>XMLHttpRequest</code>对象已创建但尚未调用<code>open()</code>方法；</li> <li>1: 代表请求已经建立，即 open()方法已经被调用；</li> <li>2: 代表请求已经发送，即<code>send()</code>方法已经被调用，并且头部和状态已经可获得；</li> <li>3: 代表请求正在处理中，即服务器正在处理请求并返回响应；</li> <li>4: 代表请求已完成，即服务器已经返回响应，<code>XMLHttpRequest</code>对象已经接收到完整的响应数据。</li></ul> <h2 id="ajax跨域"><a href="#ajax跨域" class="header-anchor">#</a> <code>Ajax</code>跨域</h2> <p><code>Ajax</code>跨域是指通过<code>XMLHttpRequest</code>对象发送请求到不同域名的服务器。在<code>Web</code>浏览器中，存在<strong>同源策略</strong>，即<code>JavaScript</code>脚本可以访问与当前文档源相同的资源，而不能访问其他源的资源。同源策略是<code>Web</code>安全模型的重要组成部分，目的是防止恶意脚本通过跨站点脚本攻击（<code>XSS</code>）等方式窃取用户信息。</p> <blockquote><p>同源策略（<code>Same Origin Policy</code>）是一种<code>Web</code>浏览器安全机制，用于保护用户数据免受恶意网站的攻击。同源策略规定，<code>JavaScript</code>脚本只能访问与自身文档源（协议、主机名、端口号）相同的资源，不能访问其他源的资源。</p></blockquote> <p>因此，如果通过<code>Ajax</code>请求访问不同源的资源，将会受到同源策略的限制，请求将被阻止。例如，如果一个网页在<code>http://www.example.com</code>域名下，它不能通过<code>Ajax</code>请求访问<code>http://api.example.net</code>域名下的资源。</p> <p>为了解决<code>Ajax</code>跨域问题，需要使用一些方法来绕过同源策略。常见的方法包括：</p> <h3 id="jsonp"><a href="#jsonp" class="header-anchor">#</a> <code>JSONP</code></h3> <p><code>JSONP</code>是一种通过动态创建<code>&lt;script&gt;</code>标签来加载外部脚本的技术，因为<code>&lt;script&gt;</code>标签没有同源策略限制，可以从不同域名加载脚本。<code>JSONP</code>的实现原理是服务器返回一个<code>JavaScript</code>回调函数，客户端通过该回调函数来获取数据。由于<code>JSONP</code>使用了<code>&lt;script&gt;</code>标签，因此只支持<code>GET</code>请求。</p> <h4 id="例子"><a href="#例子" class="header-anchor">#</a> 例子</h4> <p>假设我们有一个页面 <code>http://www.example.com/index.html</code>，需要从另一个域名 <code>http://api.example.net</code> 获取数据，可以使用如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;http://api.example.net/data?callback=handleResponse&quot;</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在这个例子中，我们定义了一个回调函数 <code>handleResponse</code>，然后动态创建了一个 <code>&lt;script&gt;</code> 标签，并将其 <code>src</code> 属性设置为 <code>http://api.example.net/data?callback=handleResponse</code>。<code>callback=handleResponse</code> 是<code>JSONP</code>的关键，它告诉服务器需要将响应包装在一个回调函数中返回。</p> <p>服务器端返回的数据应该是一个<code>JavaScript</code>函数调用，例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当浏览器接收到这个响应时，就会自动执行 <code>handleResponse</code> 函数，从而在客户端获得响应数据。由于使用了 <code>&lt;script&gt;</code> 标签，<strong><code>JSONP</code>只支持<code>GET</code>请求，不能用于发送<code>POST</code>请求</strong>。另外需要注意的是，使用<code>JSONP</code>存在一些安全隐患，因此不建议在生产环境中使用。</p> <h4 id="安全隐患"><a href="#安全隐患" class="header-anchor">#</a> 安全隐患</h4> <p><code>JSONP</code>存在一些安全隐患，主要有以下几点：</p> <ul><li>客户端难以控制回调函数名称</li></ul> <p>在<code>JSONP</code>中，客户端需要指定一个回调函数的名称，并将该名称作为参数传递给服务器。服务器返回的响应数据将被包装在该函数的调用中返回，从而在客户端中执行该函数并获取响应数据。但是客户端很难控制回调函数的名称，因为这个名称是由服务器返回的。如果恶意网站在响应中返回一个恶意的回调函数名称，可能会导致安全问题。</p> <ul><li>服务器难以验证客户端身份</li></ul> <p>在<code>JSONP</code>中，服务器无法验证客户端的身份，因为请求中包含的回调函数名称是由客户端指定的，服务器并不知道该名称是否来自合法的客户端。因此，如果服务器返回的响应数据包含敏感信息，可能会被恶意网站窃取。</p> <ul><li>服务器难以控制响应数据</li></ul> <p>在<code>JSONP</code>中，服务器无法控制响应数据的格式和内容，因为响应数据将被包装在客户端指定的回调函数的调用中返回。如果恶意网站在请求中传递了恶意代码，可能会导致安全问题。</p> <p>由于这些安全隐患，不建议在生产环境中使用<code>JSONP</code>，而应该使用更安全的跨域技术，例如<code>CORS</code>。如果必须使用<code>JSONP</code>，建议使用<code>HTTPS</code>协议，并确保响应数据经过严格的验证和过滤，以防止安全漏洞。</p> <h3 id="cors"><a href="#cors" class="header-anchor">#</a> <code>CORS</code></h3> <p><code>CORS</code>是一种支持跨域资源共享的技术，它允许服务器发送响应头，告诉浏览器允许哪些域名访问资源。通过<code>CORS</code>，可以在客户端使用<code>Ajax</code>请求跨域资源，而无需使用<code>JSONP</code>等绕过同源策略的方法。</p> <h4 id="例子-2"><a href="#例子-2" class="header-anchor">#</a> 例子</h4> <ul><li>在服务器端设置允许跨域请求的头信息</li></ul> <p>在服务器端，需要设置允许跨域请求的头信息。具体来说，需要设置 <code>Access-Control-Allow-Origin</code> 头信息，该头信息指示服务器允许哪些域名的请求访问。例如，下面的代码允许所有域名的请求访问：</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>发送<code>CORS</code>跨域请求</li></ul> <p>在客户端，可以使用<code>XMLHttpRequest</code>对象或<code>fetch</code> <code>API</code>发送<code>CORS</code>请求。发送<code>CORS</code>请求的方式与普通请求相同，只需将 <code>XMLHttpRequest</code> 对象的 <code>withCredentials</code> 属性设置为 <code>true</code>，<strong>表示允许发送跨域请求的凭证</strong>（如<code>cookies</code>、<code>HTTP</code>认证等）。</p> <p>例如，以下代码使用 <code>fetch</code> API 发送 CORS 请求：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.example.com/data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;cors&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">&quot;include&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在上面的代码中，<code>fetch</code> API 请求的第二个参数中指定了 <code>credentials: 'include'</code>，表示允许发送跨域请求的凭证。</p> <h4 id="凭证"><a href="#凭证" class="header-anchor">#</a> 凭证</h4> <p><code>CORS</code>（跨域资源共享）是一种机制，允许<code>Web</code>应用程序从不同的域访问其资源。为了提供更安全的访问控制，<code>CORS</code>还支持凭证机制。</p> <p>凭证是指在<code>CORS</code>请求中携带了<code>cookies</code>、<code>HTTP</code>认证或<code>TLS</code>客户端证书等敏感信息，而不是简单的请求。<code>CORS</code>通过两个头部来控制凭证的发送和接收：<code>Access-Control-Allow-Credentials</code> 和 <code>withCredentials</code>。</p> <p>当<code>Web</code>应用程序使用<code>CORS</code>请求时，浏览器会在发送请求之前<strong>检查目标服务器是否允许跨域请求携带凭证信息</strong>。如果目标服务器允许使用凭证进行跨域请求，那么浏览器会在请求头中设置<code>withCredentials</code>为<code>true</code>，并在发送请求时携带<code>cookie</code>等凭证信息。如果目标服务器不允许使用凭证进行跨域请求，那么浏览器将忽略<code>withCredentials</code>头部，并且不会在请求中携带凭证信息。</p> <p>目标服务器可以通过设置<code>Access-Control-Allow-Credentials</code>头部来允许或禁止携带凭证信息的跨域请求。如果服务器允许携带凭证信息的跨域请求，它必须设置<code>Access-Control-Allow-Origin</code>头部为请求源的域名，并将<code>Access-Control-Allow-Credentials</code>设置为<code>true</code>。这样，浏览器才会在发送跨域请求时携带凭证信息。</p> <blockquote><p>浏览器在发送跨域请求时，会自动在请求头中添加<code>Origin</code>字段，该字段表示请求的源地址（域名和协议）。服务器收到请求后，会根据该字段来判断是否允许该跨域请求。</p> <p>如果服务器允许当前请求的来源（即请求头中的<code>Origin</code>字段）与其自身的域名匹配，那么服务器会在响应头中添加一些<code>Access-Control-*</code>的字段，来告诉浏览器该请求可以被跨域访问，并且可以携带凭证信息。浏览器收到响应后，会检查响应头中的<code>Access-Control-*</code>字段，判断是否允许携带凭证信息。</p> <p>如果服务器不允许当前请求的来源（即请求头中的<code>Origin</code>字段）与其自身的域名匹配，那么服务器会拒绝该请求，并在响应头中添加一些<code>Access-Control-*</code>的字段，告诉浏览器该请求不能被跨域访问，或者不能携带凭证信息。</p></blockquote> <h3 id="代理服务器"><a href="#代理服务器" class="header-anchor">#</a> 代理服务器</h3> <p>代理服务器是指在客户端和服务器之间插入一个中间层，通过代理服务器来转发请求和响应。客户端通过<code>Ajax</code>请求代理服务器上的资源，而代理服务器再向目标服务器发送请求，获取数据后返回给客户端。<strong>客户端和代理服务器之间没有跨域问题，因为它们处于同一个域名下。代理服务器和目标服务器之间并不需要进行<code>CORS</code>处理，因为它们不涉及跨域问题(浏览器才有同源策略)。</strong></p> <h4 id="例子-3"><a href="#例子-3" class="header-anchor">#</a> 例子</h4> <ul><li>启动代理服务器</li></ul> <p>在本地启动一个代理服务器，用于转发客户端发送的跨域请求，并从目标服务器获取响应数据。可以使用任何一种<code>Web</code>服务器，例如<code>Node.js</code>中的<code>Express</code>。</p> <ul><li>配置代理服务器</li></ul> <p>配置代理服务器以将客户端请求转发到目标服务器，并将响应数据返回给客户端。例如，以下是一个基本的<code>Express</code>代理服务器配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> httpProxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http-proxy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> proxy <span class="token operator">=</span> httpProxy<span class="token punctuation">.</span><span class="token function">createProxyServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  proxy<span class="token punctuation">.</span><span class="token function">web</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;http://api.example.com&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Proxy server listening on port 3000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在上面的代码中，<code>http-proxy</code>模块用于创建代理服务器。<code>app.use()</code>函数用于配置路由，将所有客户端请求转发到目标服务器（<code>http://api.example.com</code>）。</p> <ul><li>发送跨域请求</li></ul> <p>在客户端，向代理服务器发送跨域请求。例如，以下是一个使用<code>fetch</code>对象发送跨域请求的示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3000/data&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在上面的代码中，客户端向代理服务器发送<code>GET</code>请求，并从代理服务器获取响应数据。</p></div></div></div> <!----></div> <div class="right"><div class="test animated bounceInRight" data-v-f32ad2be><span class="labeltitle" data-v-f32ad2be>分类</span> <div class="label-container" data-v-f32ad2be><a href="/vuepress_theme_libra/category" class="container" data-v-3c951da0 data-v-f32ad2be>
  All
</a><a href="/vuepress_theme_libra/category/css" class="container" data-v-3c951da0 data-v-f32ad2be>
  css
</a><a href="/vuepress_theme_libra/category/英语" class="container" data-v-3c951da0 data-v-f32ad2be>
  英语
</a><a href="/vuepress_theme_libra/category/flutter" class="container" data-v-3c951da0 data-v-f32ad2be>
  flutter
</a><a href="/vuepress_theme_libra/category/javascript" class="container" data-v-3c951da0 data-v-f32ad2be>
  javascript
</a><a href="/vuepress_theme_libra/category/rfc" class="container" data-v-3c951da0 data-v-f32ad2be>
  rfc
</a><a href="/vuepress_theme_libra/category/algorithm" class="container" data-v-3c951da0 data-v-f32ad2be>
  algorithm
</a></div></div> <div class="my" data-v-546102e1><div class="header-info" data-v-546102e1><div class="avatar" data-v-546102e1><img src="https://libra321.oss-cn-huhehaote.aliyuncs.com/img/IMG_0386.JPG" alt class="avatar-img" data-v-546102e1></div> <span class="name" data-v-546102e1>Libra</span> <i class="mail" data-v-546102e1>libra085925@gmail.com</i> <div class="statistics" data-v-546102e1><span class="articles" data-v-546102e1>
        39
        <i class="white" data-v-546102e1> 文章</i></span> <span class="verticle-line white" data-v-546102e1>|</span> <span class="link" data-v-546102e1>
        6
        <i class="white" data-v-546102e1> 分类</i></span></div> <a href="/vuepress_theme_libra/contact" class="more" data-v-546102e1>联系我</a></div></div> <div class="list"><div><ul><li><a href="/vuepress_theme_libra/2023/02/15/ajax%E4%B8%8E%E8%B7%A8%E5%9F%9F/#ajax">Ajax</a><ul><li><a href="/vuepress_theme_libra/2023/02/15/ajax%E4%B8%8E%E8%B7%A8%E5%9F%9F/#代码示例">代码示例</a></li><li><a href="/vuepress_theme_libra/2023/02/15/ajax%E4%B8%8E%E8%B7%A8%E5%9F%9F/#readystate">readyState</a></li></ul></li><li><a href="/vuepress_theme_libra/2023/02/15/ajax%E4%B8%8E%E8%B7%A8%E5%9F%9F/#ajax跨域">Ajax跨域</a><ul><li><a href="/vuepress_theme_libra/2023/02/15/ajax%E4%B8%8E%E8%B7%A8%E5%9F%9F/#jsonp">JSONP</a></li><li><a href="/vuepress_theme_libra/2023/02/15/ajax%E4%B8%8E%E8%B7%A8%E5%9F%9F/#cors">CORS</a></li><li><a href="/vuepress_theme_libra/2023/02/15/ajax%E4%B8%8E%E8%B7%A8%E5%9F%9F/#代理服务器">代理服务器</a></li></ul></li></ul></div></div></div></div> <div class="footer"><div class="left"><div class="wave-libra"><div class="wavetext"><div class="coast delay"><div class="wave-rel-wrap"><div class="wave delay"></div></div></div> <div class="text text-l">L</div> <div class="text text-i">i</div> <div class="text text-b">b</div> <div class="text text-r">r</div> <div class="text text-a">a</div></div></div></div> <div class="right">
    Copyright © 2019-2022 Libra | 版权所有
  </div></div></div><div class="global-ui"><!----></div></div>
    <script src="/vuepress_theme_libra/assets/js/app.81b11391.js" defer></script><script src="/vuepress_theme_libra/assets/js/4.45950cb6.js" defer></script><script src="/vuepress_theme_libra/assets/js/30.102e1636.js" defer></script>
  </body>
</html>
